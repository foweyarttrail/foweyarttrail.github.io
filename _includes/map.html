<div id = "map"></div>
<script>
     function initMap() {
       var center = {lat: 50.335458, lng: -4.640939};
       var map = new google.maps.Map(document.getElementById('map'), {
         zoom: 15,
         center: center
       });

      var stopCircle = {
         path: google.maps.SymbolPath.CIRCLE,
         fillColor: 'white',
         fillOpacity: 0.8,
         scale: 10,
         strokeColor: 'red',
         strokeWeight: 3
       };


       map.setOptions({styles: [
         {
           featureType: 'poi',
           stylers: [{visibility: 'off'}]
         },
        {
           featureType: 'poi.park',
           stylers: [{visibility: 'on'}]
         },
         {
           featureType: 'transit',
           elementType: 'labels.icon',
           stylers: [{visibility: 'off'}]
         }
       ]});
          
      var stops = [];
      var openInfos = [];
      var closeInfos = openInfos.forEach(info=>info.close())    
          
      {% for stop in site.stops %}
       stops.push({
             info : new google.maps.InfoWindow({
                 {% include blurb.html %}
             }),
             marker : new google.maps.Marker({
                   position: {lat: {{stop.latitude}}, lng: {{stop.longitude}}},
                   icon: stopCircle,
                   label: "{{stop.number}}",
                   map: map,
                   title: "{{stop.title}}"
             })
       })
      {% endfor %}
      stops.forEach(stop=>{
            stop.marker.addListener('click',()=>{
                  closeInfos()
                  stop.info.open(map,stop.marker);
                  openInfos.push(stop.info);
            })
      })          
          
      }
</script>
<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDQjwrzb1TKcqV3vpeGaHyAgk86lzwMn0o&callback=initMap">
</script>
